#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>
#include <poll.h>

// after learning more this was pointless to write, did not use

int main(int argc, char *argv[]) {
	int pfd[2];
	int nfd;
	int rv;
	if (argc < 2) {
		printf("enter fd number ???\n\n");
		return 0;
	}
	char *v = argv[1];
	int x = atoi(v);

	if (pipe(pfd) == -1) perror("bad pipe");
	printf("pipe_read %d\npipe_write %d\n", pfd[0], pfd[1]);

	if ((nfd = dup2(pfd[1], x)) == -1) perror("fd error\n");
	else printf("nfd %d\n", nfd);
	close(pfd[1]);

	struct pollfd fds[1];
	fds[0].fd = nfd;
	fds[0].events = POLLIN;
	if ((rv = poll(fds, 1, -1)) == -1) perror("poll error\n");
	else if (rv == 0) perror("timed out\n");
	
	if (fds[0].revents & POLLIN) { 
		printf("datas to read!\n");
		char buf[1024];

		read(pfd[0], buf, sizeof(buf));
		write(1, buf, sizeof(buf));
	}
	return 0;
}
